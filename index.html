<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Private Cloud Chat</title>
    <style>
        :root { --p: #6c5ce7; --bg: #0a0a0a; --c: #1a1a1a; --txt: #fff; }
        * { margin:0; padding:0; box-sizing:border-box; font-family: sans-serif; }
        body { background: var(--bg); color: var(--txt); height: 100vh; display: flex; justify-content: center; align-items: center; }
        
        /* Login */
        #login { background: var(--c); padding: 30px; border-radius: 15px; text-align: center; box-shadow: 0 0 20px #000; width: 300px; }
        input { width: 100%; padding: 12px; margin: 10px 0; border-radius: 8px; border: 1px solid #333; background: #000; color: #fff; outline: none; }
        button { width: 100%; padding: 12px; background: var(--p); border: none; color: #fff; border-radius: 8px; cursor: pointer; font-weight: bold; }

        /* Chat UI */
        #chat-ui { display: none; width: 100%; max-width: 500px; height: 95vh; background: var(--c); flex-direction: column; border-radius: 15px; overflow: hidden; }
        #msgs { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; background: #111; }
        
        .m { max-width: 80%; padding: 10px 15px; border-radius: 15px; font-size: 14px; line-height: 1.4; position: relative; }
        .me { align-self: flex-end; background: var(--p); border-bottom-right-radius: 2px; }
        .frnd { align-self: flex-start; background: #333; border-bottom-left-radius: 2px; }
        
        .rep-box { display: block; font-size: 11px; opacity: 0.7; border-left: 2px solid #fff; padding-left: 5px; margin-bottom: 5px; }
        
        .input-area { padding: 15px; background: #1a1a1a; border-top: 1px solid #333; }
        #rep-preview { display:none; background: #222; padding: 5px 10px; font-size: 12px; border-radius: 5px; margin-bottom: 5px; justify-content: space-between; }
    </style>
</head>
<body>

    <div id="login">
        <h3>ðŸ”’ Secret Pass</h3>
        <input type="password" id="pass" placeholder="Password">
        <button onclick="auth()">Login</button>
    </div>

    <div id="chat-ui">
        <div style="padding:15px; background: #222; text-align:center; font-weight:bold;">BFF PRIVATE CHAT</div>
        <div id="msgs"></div>
        <div class="input-area">
            <div id="rep-preview"><span id="rep-txt"></span> <span onclick="cancelRep()" style="color:red; cursor:pointer">âœ–</span></div>
            <div style="display:flex; gap:10px;">
                <input type="text" id="msgInput" placeholder="Message..." autocomplete="off">
                <button onclick="send()" style="width: 60px;">âž¤</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, onChildAdded } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // à§§. à¦†à¦ªà¦¨à¦¾à¦° Firebase Config à¦à¦–à¦¾à¦¨à§‡ à¦¸à¦ à¦¿à¦•à¦­à¦¾à¦¬à§‡ à¦¬à¦¸à¦¾à¦¨
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT.firebaseapp.com",
            databaseURL: "https://YOUR_PROJECT-default-rtdb.firebaseio.com",
            projectId: "YOUR_PROJECT",
            storageBucket: "YOUR_PROJECT.appspot.com",
            messagingSenderId: "YOUR_ID",
            appId: "YOUR_APP_ID"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const passKey = "123"; // à¦†à¦ªà¦¨à¦¾à¦° à¦ªà¦¾à¦¸à¦“à§Ÿà¦¾à¦°à§à¦¡

        let myID = localStorage.getItem('chat_uid') || 'u_' + Math.random().toString(36).substr(2, 5);
        localStorage.setItem('chat_uid', myID);

        let selectedReply = null;

        // à¦²à¦—à¦‡à¦¨ à¦«à¦¾à¦‚à¦¶à¦¨
        window.auth = () => {
            if(document.getElementById('pass').value === passKey) {
                document.getElementById('login').style.display = 'none';
                document.getElementById('chat-ui').style.display = 'flex';
                initChat();
            } else { alert("Wrong Pass!"); }
        };

        // à¦®à§‡à¦¸à§‡à¦œ à¦ªà¦¾à¦ à¦¾à¦¨à§‹
        window.send = () => {
            const inp = document.getElementById('msgInput');
            if(!inp.value.trim()) return;
            
            push(ref(db, 'chats'), {
                uid: myID,
                text: inp.value,
                reply: selectedReply,
                time: Date.now()
            });
            inp.value = "";
            cancelRep();
        };

        // à¦®à§‡à¦¸à§‡à¦œ à¦²à§‹à¦¡ (Real-time)
        function initChat() {
            onChildAdded(ref(db, 'chats'), (snap) => {
                const data = snap.val();
                const div = document.createElement('div');
                div.className = `m ${data.uid === myID ? 'me' : 'frnd'}`;
                
                let html = data.reply ? `<span class="rep-box">Replying to: ${data.reply}</span>` : "";
                html += `<span>${data.text}</span>`;
                div.innerHTML = html;

                // à¦¡à¦¾à¦¬à¦² à¦•à§à¦²à¦¿à¦• à¦•à¦°à¦²à§‡ à¦°à¦¿à¦ªà§à¦²à¦¾à¦‡ à¦¸à§‡à¦Ÿ à¦¹à¦¬à§‡
                div.ondblclick = () => {
                    selectedReply = data.text;
                    document.getElementById('rep-preview').style.display = 'flex';
                    document.getElementById('rep-txt').innerText = "Replying: " + data.text;
                };

                document.getElementById('msgs').appendChild(div);
                document.getElementById('msgs').scrollTop = document.getElementById('msgs').scrollHeight;
            });
        }

        window.cancelRep = () => { selectedReply = null; document.getElementById('rep-preview').style.display = 'none'; };

        // Enter key Support
        document.addEventListener('keypress', (e) => { if(e.key === 'Enter') window.send(); });
    </script>
</body>
</html>